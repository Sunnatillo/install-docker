---
  - name: Installing Docker
    hosts: localhost
    connection: local
    tasks:

    - name: Install docker
      block:
        - name: Add Dockerâ€™s GPG key
          ansible.builtin.shell: |
            sudo mkdir -m 0755 -p /etc/apt/keyrings
            curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg

        - name: Add Docker Repository
          ansible.builtin.shell: |
            echo \
            "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \
            $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null

        - name: Update all packages to their latest version
          apt:
            name: "*"
            state: latest

        - name: Install docker
          apt: name={{ item }} state=latest update_cache=yes
          loop: [ 'containerd.io' ]

        - name: Add current user to the docker group
          user:
            name: "{{ lookup('env','USER') }}"
            groups: docker
            append: yes
      become: yes