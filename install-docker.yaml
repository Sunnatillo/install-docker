---
  - name: Installing Docker
    hosts: localhost
    connection: local
    tasks:

    - name: Install docker
      block:
        - name: Add Dockerâ€™s GPG key
          apt_key:
            url: https://download.docker.com/linux/ubuntu/gpg
            state: present

        - name: Add Docker Repository
          apt_repository:
            repo: "deb https://download.docker.com/linux/ubuntu {{ ansible_distribution_release }} stable"
            state: present

        - name: Update all packages to their latest version
          apt:
            name: "*"
            state: latest

        - name: Install docker
          apt: name={{ item }} state=latest update_cache=yes
          loop: [ 'docker-ce', 'docker-ce-cli', 'containerd.io' ]

        - name: Restart docker systemd service
          service:
            name: docker
            state: restarted
            daemon_reload: yes

        - name: Add current user to the docker group
          user:
            name: "{{ lookup('env','USER') }}"
            groups: docker
            append: yes
      become: yes